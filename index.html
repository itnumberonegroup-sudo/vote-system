<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Number One Market - Vote & Win</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&family=Noto+Sans+Myanmar:wght@400;700&family=Noto+Sans+Lao:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #28a745;
            --secondary-color: #ffc107;
            --bg-color: #f8fafc;
            --text-dark: #1e293b;
            --error-color: #ef4444;
            --card-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Prompt', 'Noto Sans Myanmar', 'Noto Sans Lao', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px 15px;
            color: var(--text-dark);
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container { width: 100%; max-width: 480px; }

        .lang-switcher-container {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 12px;
            align-items: center;
            gap: 8px;
        }
        .lang-label { font-size: 13px; color: #64748b; font-weight: 400; }
        .lang-select {
            padding: 8px 12px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
            background-color: white;
            font-family: inherit;
            font-size: 13px;
            color: var(--text-dark);
            cursor: pointer;
            outline: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .header-banner {
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.6)), url('https://images.unsplash.com/photo-1555529771-835f59fc5efe?auto=format&fit=crop&q=80&w=1000');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 40px 20px;
            border-radius: 30px 30px 0 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header-banner h1 { margin: 0; font-size: 20px; font-weight: 600; line-height: 1.3; }
        .header-banner p { margin: 8px 0 0; font-weight: 300; font-size: 14px; opacity: 0.9; }
        .prize-badge {
            background: var(--secondary-color);
            color: #856404;
            display: inline-block;
            padding: 6px 15px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 13px;
            margin-top: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        #voteForm {
            background: white;
            padding: 25px;
            border-radius: 0 0 30px 30px;
            box-shadow: var(--card-shadow);
        }

        .shop-info { 
            text-align: center; 
            margin-bottom: 20px; 
            border-bottom: 2px solid #f1f5f9; 
            padding-bottom: 15px; 
        }
        .shop-info h2 { margin: 5px 0; color: var(--primary-color); font-size: 24px; }

        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 14px; color: #475569; }
        .input-control { width: 100%; padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 12px; font-family: inherit; font-size: 15px; box-sizing: border-box; }

        .rating-container {
            background: #f8fafc;
            padding: 15px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
        }
        .stars { display: flex; flex-direction: row-reverse; justify-content: center; gap: 8px; }
        .stars input { display: none; }
        .stars label { font-size: 36px; color: #cbd5e1; cursor: pointer; }
        .stars input:checked ~ label { color: var(--secondary-color); }

        .pdpa-container {
            margin: 20px 0;
            padding: 12px;
            background: #fffcf0;
            border-radius: 12px;
            border: 1px solid #ffeeba;
            font-size: 11px;
            color: #666;
        }
        .pdpa-checkbox { display: flex; align-items: flex-start; gap: 8px; cursor: pointer; }

        .btn-submit {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 15px;
            width: 100%;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
        }
        .btn-submit:disabled { background-color: #94a3b8; cursor: not-allowed; }

        /* Modal / Alert */
        #customAlert {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .modal-content { background: white; padding: 25px; border-radius: 20px; text-align: center; max-width: 320px; width: 100%; box-sizing: border-box; }

        #loading {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.9);
            z-index: 3000;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .spinner {
            width: 40px; height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="loading">
        <div class="spinner"></div>
        <p id="txt-loading" style="margin-top: 15px; font-weight: 600;">à¸à¸³à¸¥à¸±à¸‡à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥...</p>
    </div>

    <div id="customAlert" onclick="closeAlert()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div id="modalIcon" class="modal-icon" style="font-size: 40px; margin-bottom: 10px;"></div>
            <h3 id="modalTitle" style="margin: 0;"></h3>
            <p id="modalMsg" style="color: #64748b; margin-top: 10px;"></p>
            <button style="margin-top: 15px; padding: 10px 30px; border-radius: 10px; border: none; background: #334155; color: white; cursor: pointer;" id="btn-modal-close" onclick="closeAlert()">à¸•à¸à¸¥à¸‡</button>
        </div>
    </div>

    <div class="container">
        <div class="lang-switcher-container">
            <span class="lang-label"><i class="fas fa-globe"></i> Language:</span>
            <select class="lang-select" id="langSelect" onchange="changeLang(this.value)">
                <option value="th">à¸ à¸²à¸©à¸²à¹„à¸—à¸¢</option>
                <option value="en">English</option>
                <option value="zh">ä¸­æ–‡ (Chinese)</option>
                <option value="ja">æ—¥æœ¬èª (Japanese)</option>
                <option value="my">á€™á€¼á€”á€ºá€™á€¬á€˜á€¬á€á€¬ (Myanmar)</option>
                <option value="lo">àºàº²àºªàº²àº¥àº²àº§ (Lao)</option>
                <option value="id">Bahasa Indonesia</option>
                <option value="vi">Tiáº¿ng Viá»‡t (Vietnamese)</option>
            </select>
        </div>

        <div class="header-banner">
            <h1 id="txt-header">THE BEST OF NUMBER ONE MARKET</h1>
            <p id="txt-subtitle">à¹‚à¸«à¸§à¸•à¸£à¹‰à¸²à¸™à¸„à¹‰à¸²à¹€à¸à¸·à¹ˆà¸­à¸¥à¸¸à¹‰à¸™à¸£à¸±à¸šà¸‚à¸­à¸‡à¸£à¸²à¸‡à¸§à¸±à¸¥!!</p>
            <div class="prize-badge" id="txt-prize"><i class="fas fa-motorcycle"></i> à¸¥à¸¸à¹‰à¸™à¸£à¸±à¸šà¸—à¸­à¸‡à¸„à¸³ à¹à¸¥à¸° à¸£à¸–à¸¡à¸­à¹€à¸•à¸­à¸£à¹Œà¹„à¸‹à¸„à¹Œ!</div>
        </div>

        <div id="voteForm">
            <div id="alreadyVotedMsg" style="display: none; background: #fee2e2; color: #991b1b; padding: 10px; border-radius: 10px; margin-bottom: 15px; text-align: center; font-size: 13px;">à¸§à¸±à¸™à¸™à¸µà¹‰à¸„à¸¸à¸“à¹‚à¸«à¸§à¸•à¸£à¹‰à¸²à¸™à¸„à¹‰à¸²à¸™à¸µà¹‰à¹„à¸›à¹à¸¥à¹‰à¸§</div>
            
            <div class="shop-info">
                <div id="txt-selected-shop" style="font-size: 13px; color: #94a3b8; font-weight: 400;">à¸£à¹‰à¸²à¸™à¸„à¹‰à¸²à¸—à¸µà¹ˆà¸—à¹ˆà¸²à¸™à¹€à¸¥à¸·à¸­à¸</div>
                <h2 id="shopNameDisplay">à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸£à¹‰à¸²à¸™à¸„à¹‰à¸²...</h2>
            </div>

            <div class="input-group">
                <label id="lbl-name"><i class="fas fa-user"></i> à¸Šà¸·à¹ˆà¸­ â€“ à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥ (à¹€à¸à¸·à¹ˆà¸­à¸£à¸±à¸šà¸£à¸²à¸‡à¸§à¸±à¸¥)</label>
                <input type="text" id="nameInput" class="input-control" placeholder="à¸£à¸°à¸šà¸¸à¸Šà¸·à¹ˆà¸­-à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥">
            </div>

            <div class="input-group">
                <label id="lbl-phone"><i class="fas fa-phone"></i> à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£à¸¨à¸±à¸à¸—à¹Œ</label>
                <input type="tel" id="phoneInput" class="input-control" placeholder="0XXXXXXXXX" maxlength="10">
            </div>

            <div class="rating-container">
                <span class="rating-label" id="txt-rate-label" style="font-weight:600; display:block; margin-bottom:10px;">à¹ƒà¸«à¹‰à¸„à¸°à¹à¸™à¸™à¸£à¹‰à¸²à¸™à¸„à¹‰à¸²</span>
                <div class="stars">
                    <input type="radio" name="score_quality" id="q5" value="5"><label for="q5" class="fas fa-star"></label>
                    <input type="radio" name="score_quality" id="q4" value="4"><label for="q4" class="fas fa-star"></label>
                    <input type="radio" name="score_quality" id="q3" value="3"><label for="q3" class="fas fa-star"></label>
                    <input type="radio" name="score_quality" id="q2" value="2"><label for="q2" class="fas fa-star"></label>
                    <input type="radio" name="score_quality" id="q1" value="1"><label for="q1" class="fas fa-star"></label>
                </div>
            </div>

            <div class="pdpa-container">
                <label class="pdpa-checkbox">
                    <input type="checkbox" id="pdpaConsent">
                    <span id="txt-pdpa">
                        à¸šà¸£à¸´à¸à¸²à¸£à¸ˆà¸°à¸ˆà¸±à¸”à¹€à¸à¹‡à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸‚à¸­à¸‡à¸—à¹ˆà¸²à¸™ à¹€à¸à¸·à¹ˆà¸­à¸à¸²à¸£à¸•à¸´à¸”à¸•à¹ˆà¸­à¸ªà¸·à¹ˆà¸­à¸ªà¸²à¸£ à¸šà¸£à¸´à¸©à¸±à¸— à¸™à¸±à¸¡à¹€à¸šà¸­à¸£à¹Œ à¸§à¸±à¸™ à¸ˆà¸³à¸à¸±à¸” à¸—à¹ˆà¸²à¸™à¸ªà¸²à¸¡à¸²à¸£à¸–à¸¨à¸¶à¸à¸©à¸²à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¹€à¸à¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡à¹„à¸”à¹‰à¸ˆà¸²à¸ 
                        <a href="https://www.numberonemarket.com/privacy.php" target="_blank" id="txt-pdpa-link">à¸›à¸£à¸°à¸à¸²à¸¨à¸„à¸§à¸²à¸¡à¹€à¸›à¹‡à¸™à¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§</a>*
                    </span>
                </label>
            </div>

            <button class="btn-submit" id="btnSubmit" onclick="validateAndSubmit()">à¸¢à¸·à¸™à¸¢à¸±à¸™à¸à¸²à¸£à¹ƒà¸«à¹‰à¸„à¸°à¹à¸™à¸™</button>
        </div>
    </div>

    <script>
        const LIFF_ID = '2009067055-3oHER0LB'; 
        // ğŸ‘‡ à¸§à¸²à¸‡ URL à¹ƒà¸«à¸¡à¹ˆà¹à¸„à¹ˆà¸¥à¸´à¸‡à¸à¹Œà¹€à¸”à¸µà¸¢à¸§à¸•à¸£à¸‡à¸™à¸µà¹‰à¸„à¸£à¸±à¸š ğŸ‘‡
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzqivlHPlhxD6eAAWxLkar_pyGxeFmL-itm8eIjlNvXE8SRwLRDUNyCY3fXwVwoCzCf8w/exec';

        let currentShopId = "";
        let currentShopName = "";
        let currentLang = 'th';

        const translations = {
            th: {
                header: "THE BEST OF NUMBER ONE MARKET",
                subtitle: "à¹‚à¸«à¸§à¸•à¸£à¹‰à¸²à¸™à¸„à¹‰à¸²à¹€à¸à¸·à¹ˆà¸­à¸¥à¸¸à¹‰à¸™à¸£à¸±à¸šà¸‚à¸­à¸‡à¸£à¸²à¸‡à¸§à¸±à¸¥!!",
                prize: "à¸¥à¸¸à¹‰à¸™à¸£à¸±à¸šà¸—à¸­à¸‡à¸„à¸³ à¹à¸¥à¸° à¸£à¸–à¸¡à¸­à¹€à¸•à¸­à¸£à¹Œà¹„à¸‹à¸„à¹Œ!",
                alreadyVoted: "à¸§à¸±à¸™à¸™à¸µà¹‰à¸„à¸¸à¸“à¹‚à¸«à¸§à¸•à¸£à¹‰à¸²à¸™à¸„à¹‰à¸²à¸™à¸µà¹‰à¹„à¸›à¹à¸¥à¹‰à¸§",
                selectedShop: "à¸£à¹‰à¸²à¸™à¸„à¹‰à¸²à¸—à¸µà¹ˆà¸—à¹ˆà¸²à¸™à¹€à¸¥à¸·à¸­à¸",
                lblName: "à¸Šà¸·à¹ˆà¸­ â€“ à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥ (à¹€à¸à¸·à¹ˆà¸­à¸£à¸±à¸šà¸£à¸²à¸‡à¸§à¸±à¸¥)",
                namePlaceholder: "à¸£à¸°à¸šà¸¸à¸Šà¸·à¹ˆà¸­-à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥",
                lblPhone: "à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£à¸¨à¸±à¸à¸—à¹Œ",
                phonePlaceholder: "0XXXXXXXXX",
                rateLabel: "à¹ƒà¸«à¹‰à¸„à¸°à¹à¸™à¸™à¸£à¹‰à¸²à¸™à¸„à¹‰à¸²",
                pdpa: "à¸šà¸£à¸´à¸à¸²à¸£à¸ˆà¸°à¸ˆà¸±à¸”à¹€à¸à¹‡à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸‚à¸­à¸‡à¸—à¹ˆà¸²à¸™ à¹€à¸à¸·à¹ˆà¸­à¸à¸²à¸£à¸•à¸´à¸”à¸•à¹ˆà¸­à¸ªà¸·à¹ˆà¸­à¸ªà¸²à¸£ à¸šà¸£à¸´à¸©à¸±à¸— à¸™à¸±à¸¡à¹€à¸šà¸­à¸£à¹Œ à¸§à¸±à¸™ à¸ˆà¸³à¸à¸±à¸” à¸—à¹ˆà¸²à¸™à¸ªà¸²à¸¡à¸²à¸£à¸–à¸¨à¸¶à¸à¸©à¸²à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¹€à¸à¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡à¹„à¸”à¹‰à¸ˆà¸²à¸ ",
                pdpaLink: "à¸›à¸£à¸°à¸à¸²à¸¨à¸„à¸§à¸²à¸¡à¹€à¸›à¹‡à¸™à¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§",
                submit: "à¸¢à¸·à¸™à¸¢à¸±à¸™à¸à¸²à¸£à¹ƒà¸«à¹‰à¸„à¸°à¹à¸™à¸™",
                loading: "à¸à¸³à¸¥à¸±à¸‡à¸šà¸±à¸™à¸—à¸¶à¸à¸„à¸°à¹à¸™à¸™...",
                alertIncomplete: "à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸¡à¹ˆà¸„à¸£à¸š",
                alertIncompleteMsg: "à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­à¹à¸¥à¸°à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£à¸¨à¸±à¸à¸—à¹Œ",
                alertPhoneError: "à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£à¸¨à¸±à¸à¸—à¹Œà¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡",
                alertRateError: "à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¸”à¸²à¸§ 1-5 à¸”à¸²à¸§",
                alertPdpaError: "à¸à¸£à¸¸à¸“à¸²à¸¢à¸­à¸¡à¸£à¸±à¸šà¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚à¸„à¸§à¸²à¸¡à¹€à¸›à¹‡à¸™à¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§",
                alertSuccess: "à¸ªà¸³à¹€à¸£à¹‡à¸ˆ!",
                alertSuccessMsg: "à¸‚à¸­à¸šà¸„à¸¸à¸“à¸—à¸µà¹ˆà¸£à¹ˆà¸§à¸¡à¸ªà¸™à¸¸à¸à¸„à¸£à¸±à¸š",
                alertFail: "à¸‚à¸­à¸­à¸ à¸±à¸¢",
                alertFailMsg: "à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸” à¸à¸£à¸¸à¸“à¸²à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ",
                btnOk: "à¸•à¸à¸¥à¸‡"
            },
            en: {
                header: "THE BEST OF NUMBER ONE MARKET",
                subtitle: "Vote for your favorite shop to win prizes!!",
                prize: "Win Gold and Motorcycles!",
                alreadyVoted: "Already voted today",
                selectedShop: "Selected Shop",
                lblName: "Full Name (for prizes)",
                namePlaceholder: "Enter full name",
                lblPhone: "Phone Number",
                phonePlaceholder: "0XXXXXXXXX",
                rateLabel: "Rate this shop",
                pdpa: "Your info will be collected for communication by Number One Co., Ltd. More details in our ",
                pdpaLink: "Privacy Policy",
                submit: "Confirm Rating",
                loading: "Saving...",
                alertIncomplete: "Incomplete",
                alertIncompleteMsg: "Please fill in all fields",
                alertPhoneError: "Invalid phone number",
                alertRateError: "Select 1-5 stars",
                alertPdpaError: "Accept privacy policy",
                alertSuccess: "Success!",
                alertSuccessMsg: "Thank you for your feedback",
                alertFail: "Error",
                alertFailMsg: "Something went wrong",
                btnOk: "OK"
            },
            zh: {
                header: "THE BEST OF NUMBER ONE MARKET",
                subtitle: "æŠ•ç¥¨ç»™ä½ å–œæ¬¢çš„åº—é“ºï¼Œèµ¢å–å¥–å“ï¼ï¼",
                prize: "èµ¢å–é»„é‡‘å’Œæ‘©æ‰˜è½¦ï¼",
                alreadyVoted: "ä»Šå¤©å·²ç»æŠ•ç¥¨äº†",
                selectedShop: "æ‰€é€‰åº—é“º",
                lblName: "å§“åï¼ˆç”¨äºé¢†å¥–ï¼‰",
                namePlaceholder: "è¾“å…¥å…¨å",
                lblPhone: "ç”µè¯å·ç ",
                phonePlaceholder: "è¯·è¾“å…¥ç”µè¯å·ç ",
                rateLabel: "è¯„ä»·è¯¥åº—é“º",
                pdpa: "æ‚¨çš„ä¿¡æ¯å°†è¢«æ”¶é›†ç”¨äºè”ç³»ã€‚è¯¦æƒ…è¯·å‚é˜… ",
                pdpaLink: "éšç§æ”¿ç­–",
                submit: "ç¡®è®¤è¯„åˆ†",
                loading: "ä¿å­˜ä¸­...",
                alertIncomplete: "ä¿¡æ¯ä¸å®Œæ•´",
                alertIncompleteMsg: "è¯·å¡«å†™æ‰€æœ‰å­—æ®µ",
                alertPhoneError: "ç”µè¯å·ç æ— æ•ˆ",
                alertRateError: "è¯·é€‰æ‹©1-5æ˜Ÿ",
                alertPdpaError: "è¯·æ¥å—éšç§æ”¿ç­–",
                alertSuccess: "æˆåŠŸï¼",
                alertSuccessMsg: "æ„Ÿè°¢æ‚¨çš„åé¦ˆ",
                alertFail: "é”™è¯¯",
                alertFailMsg: "å‘ç”Ÿäº†ä¸€äº›é”™è¯¯",
                btnOk: "ç¡®å®š"
            },
            ja: {
                header: "THE BEST OF NUMBER ONE MARKET",
                subtitle: "ãŠæ°—ã«å…¥ã‚Šã®åº—ã«æŠ•ç¥¨ã—ã¦è³å“ã‚’å½“ã¦ã‚ˆã†ï¼",
                prize: "é‡‘ã‚„ãƒã‚¤ã‚¯ãŒå½“ãŸã‚‹ï¼",
                alreadyVoted: "æœ¬æ—¥ã¯æŠ•ç¥¨æ¸ˆã¿ã§ã™",
                selectedShop: "é¸æŠã•ã‚ŒãŸåº—èˆ—",
                lblName: "ãŠåå‰ï¼ˆè³å“å—ã‘å–ã‚Šç”¨ï¼‰",
                namePlaceholder: "ãƒ•ãƒ«ãƒãƒ¼ãƒ ã‚’å…¥åŠ›",
                lblPhone: "é›»è©±ç•ªå·",
                phonePlaceholder: "é›»è©±ç•ªå·ã‚’å…¥åŠ›",
                rateLabel: "ãŠåº—ã‚’è©•ä¾¡ã™ã‚‹",
                pdpa: "ãŠå®¢æ§˜ã®æƒ…å ±ã¯ã€é€£çµ¡ã®ãŸã‚ã«åé›†ã•ã‚Œã¾ã™ã€‚è©³ç´°ã¯ ",
                pdpaLink: "ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼",
                submit: "è©•ä¾¡ã‚’ç¢ºå®šã™ã‚‹",
                loading: "ä¿å­˜ä¸­...",
                alertIncomplete: "å…¥åŠ›ä¸å‚™",
                alertIncompleteMsg: "ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",
                alertPhoneError: "é›»è©±ç•ªå·ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“",
                alertRateError: "1ã€œ5æ˜Ÿã‚’é¸æŠã—ã¦ãã ã•ã„",
                alertPdpaError: "ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã«åŒæ„ã—ã¦ãã ã•ã„",
                alertSuccess: "æˆåŠŸï¼",
                alertSuccessMsg: "ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™",
                alertFail: "ã‚¨ãƒ©ãƒ¼",
                alertFailMsg: "å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸ",
                btnOk: "ã¯ã„"
            },
            my: {
                header: "THE BEST OF NUMBER ONE MARKET",
                subtitle: "á€†á€¯á€œá€€á€ºá€†á€±á€¬á€„á€ºá€™á€»á€¬á€¸á€›á€šá€°á€›á€”á€º á€á€„á€ºá€¡á€€á€¼á€­á€¯á€€á€ºá€†á€¯á€¶á€¸á€†á€­á€¯á€„á€ºá€€á€­á€¯ á€™á€²á€•á€±á€¸á€•á€«!!",
                prize: "á€›á€½á€¾á€±á€”á€¾á€„á€·á€º á€†á€­á€¯á€„á€ºá€€á€šá€ºá€™á€»á€¬á€¸ á€€á€¶á€‘á€°á€¸á€”á€­á€¯á€„á€ºá€á€½á€„á€·á€º!",
                alreadyVoted: "á€šá€”á€±á€·á€¡á€á€½á€€á€º á€™á€²á€•á€±á€¸á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®",
                selectedShop: "á€›á€½á€±á€¸á€á€»á€šá€ºá€‘á€¬á€¸á€á€±á€¬á€†á€­á€¯á€„á€º",
                lblName: "á€¡á€™á€Šá€º (á€†á€¯á€›á€›á€¾á€­á€›á€”á€ºá€¡á€á€½á€€á€º)",
                namePlaceholder: "á€¡á€™á€Šá€ºá€¡á€•á€¼á€Šá€·á€ºá€¡á€…á€¯á€¶á€‘á€Šá€·á€ºá€•á€«",
                lblPhone: "á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€«á€á€º",
                phonePlaceholder: "á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€«á€á€ºá€‘á€Šá€·á€ºá€•á€«",
                rateLabel: "á€¤á€†á€­á€¯á€„á€ºá€€á€­á€¯ á€¡á€†á€„á€·á€ºá€á€á€ºá€™á€¾á€á€ºá€•á€«",
                pdpa: "á€á€„á€ºáá€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€™á€»á€¬á€¸á€€á€­á€¯ á€†á€€á€ºá€á€½á€šá€ºá€›á€”á€ºá€¡á€á€½á€€á€º á€á€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€™á€Šá€ºá€–á€¼á€…á€ºá€á€Šá€ºá‹ á€¡á€á€±á€¸á€…á€­á€á€ºá€€á€­á€¯ ",
                pdpaLink: "á€€á€­á€¯á€šá€ºá€›á€±á€¸á€€á€­á€¯á€šá€ºá€á€¬á€™á€°á€á€«á€’",
                submit: "á€¡á€†á€„á€·á€ºá€á€á€ºá€™á€¾á€á€ºá€á€»á€€á€ºá€€á€­á€¯ á€¡á€á€Šá€ºá€•á€¼á€¯á€•á€«",
                loading: "á€á€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€”á€±á€á€Šá€º...",
                alertIncomplete: "á€™á€•á€¼á€Šá€·á€ºá€…á€¯á€¶á€•á€«",
                alertIncompleteMsg: "á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€¡á€¬á€¸á€œá€¯á€¶á€¸á€€á€­á€¯ á€–á€¼á€Šá€·á€ºá€…á€½á€€á€ºá€•á€«",
                alertPhoneError: "á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€«á€á€º á€™á€¾á€¬á€¸á€šá€½á€„á€ºá€¸á€”á€±á€•á€«á€á€Šá€º",
                alertRateError: "á€€á€¼á€šá€º á-á… á€á€¯ á€›á€½á€±á€¸á€á€»á€šá€ºá€•á€«",
                alertPdpaError: "á€™á€°á€á€«á€’á€€á€­á€¯ á€á€˜á€±á€¬á€á€°á€Šá€®á€•á€«",
                alertSuccess: "á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€•á€«á€á€Šá€º!",
                alertSuccessMsg: "á€¡á€€á€¼á€¶á€•á€¼á€¯á€á€»á€€á€ºá€¡á€á€½á€€á€º á€€á€»á€±á€¸á€‡á€°á€¸á€á€„á€ºá€•á€«á€á€Šá€º",
                alertFail: "á€¡á€™á€¾á€¬á€¸á€¡á€šá€½á€„á€ºá€¸",
                alertFailMsg: "á€á€…á€ºá€á€¯á€á€¯ á€™á€¾á€¬á€¸á€šá€½á€„á€ºá€¸á€”á€±á€•á€«á€á€Šá€º",
                btnOk: "á€¡á€­á€¯á€€á€±"
            },
            lo: {
                header: "THE BEST OF NUMBER ONE MARKET",
                subtitle: "à»‚àº«àº§àº”àº®à»‰àº²àº™àº„à»‰àº²à»€àºàº·à»ˆàº­àº¥àº¸à»‰àº™àº®àº±àºšàº‚àº­àº‡àº¥àº²àº‡àº§àº±àº™!!",
                prize: "àº¥àº¸à»‰àº™àº®àº±àºšàº„àº³ à»àº¥àº° àº¥àº»àº”àºˆàº±àº!",
                alreadyVoted: "àº¡àº·à»‰àº™àºµà»‰àº—à»ˆàº²àº™à»‚àº«àº§àº”àº®à»‰àº²àº™àº™àºµà»‰à»àº¥à»‰àº§",
                selectedShop: "àº®à»‰àº²àº™àº—àºµà»ˆàº—à»ˆàº²àº™à»€àº¥àº·àº­àº",
                lblName: "àºŠàº·à»ˆ à»àº¥àº° àº™àº²àº¡àºªàº°àºàº¸àº™ (à»€àºàº·à»ˆàº­àº®àº±àºšàº¥àº²àº‡àº§àº±àº™)",
                namePlaceholder: "à»ƒàºªà»ˆàºŠàº·à»ˆ-àº™àº²àº¡àºªàº°àºàº¸àº™",
                lblPhone: "à»€àºšàºµà»‚àº—àº¥àº°àºªàº±àºš",
                phonePlaceholder: "à»ƒàºªà»ˆà»€àºšàºµà»‚àº—àº¥àº°àºªàº±àºš",
                rateLabel: "à»ƒàº«à»‰àº„àº°à»àº™àº™àº®à»‰àº²àº™àº„à»‰àº²",
                pdpa: "àº‚à»à»‰àº¡àº¹àº™àº‚àº­àº‡àº—à»ˆàº²àº™àºˆàº°àº–àº·àºà»€àºàº±àºšà»„àº§à»‰à»€àºàº·à»ˆàº­àºàº²àº™àº•àº´àº”àº•à»à»ˆ. àºªàº¶àºàºªàº²à»€àºàºµà»ˆàº¡à»€àº•àºµàº¡à»„àº”à»‰àº—àºµà»ˆ ",
                pdpaLink: "àº™àº°à»‚àºàºšàº²àºàº„àº§àº²àº¡à»€àº›àº±àº™àºªà»ˆàº§àº™àº•àº»àº§",
                submit: "àº¢àº·àº™àº¢àº±àº™àºàº²àº™à»ƒàº«à»‰àº„àº°à»àº™àº™",
                loading: "àºàº³àº¥àº±àº‡àºšàº±àº™àº—àº¶àº...",
                alertIncomplete: "àº‚à»à»‰àº¡àº¹àº™àºšà»à»ˆàº„àº»àºš",
                alertIncompleteMsg: "àºàº°àº¥àº¸àº™àº²à»ƒàºªà»ˆàº‚à»à»‰àº¡àº¹àº™à»ƒàº«à»‰àº„àº»àºš",
                alertPhoneError: "à»€àºšàºµà»‚àº—àº¥àº°àºªàº±àºšàºšà»à»ˆàº–àº·àºàº•à»‰àº­àº‡",
                alertRateError: "àºàº°àº¥àº¸àº™àº²à»€àº¥àº·àº­àº 1-5 àº”àº²àº§",
                alertPdpaError: "àºàº°àº¥àº¸àº™àº²àº¢àº·àº™àº¢àº±àº™àº™àº°à»‚àºàºšàº²àº",
                alertSuccess: "àºªàº³à»€àº¥àº±àº”!",
                alertSuccessMsg: "àº‚àº­àºšà»ƒàºˆàº—àºµà»ˆàº®à»ˆàº§àº¡àºàº´àº”àºˆàº°àºàº³",
                alertFail: "àº‚à»àº­àº°à»„àº",
                alertFailMsg: "à»€àºàºµàº”àº‚à»à»‰àºœàº´àº”àºàº²àº”",
                btnOk: "àº•àº»àºàº¥àº»àº‡"
            },
            id: {
                header: "THE BEST OF NUMBER ONE MARKET",
                subtitle: "Pilih toko favorit Anda untuk memenangkan hadiah!!",
                prize: "Menangkan Emas dan Sepeda Motor!",
                alreadyVoted: "Sudah memilih hari ini",
                selectedShop: "Toko yang Dipilih",
                lblName: "Nama Lengkap (untuk hadiah)",
                namePlaceholder: "Masukkan nama lengkap",
                lblPhone: "Nomor Telepon",
                phonePlaceholder: "Masukkan nomor telepon",
                rateLabel: "Beri nilai toko ini",
                pdpa: "Data Anda akan disimpan untuk komunikasi. Detail lebih lanjut di ",
                pdpaLink: "Kebijakan Privasi",
                submit: "Konfirmasi Penilaian",
                loading: "Menyimpan...",
                alertIncomplete: "Tidak Lengkap",
                alertIncompleteMsg: "Harap isi semua bidang",
                alertPhoneError: "Nomor telepon tidak valid",
                alertRateError: "Pilih 1-5 bintang",
                alertPdpaError: "Setujui kebijakan privasi",
                alertSuccess: "Berhasil!",
                alertSuccessMsg: "Terima kasih atas tanggapan Anda",
                alertFail: "Kesalahan",
                alertFailMsg: "Terjadi kesalahan",
                btnOk: "OKE"
            },
            vi: {
                header: "THE BEST OF NUMBER ONE MARKET",
                subtitle: "BÃ¬nh chá»n cho cá»­a hÃ ng yÃªu thÃ­ch Ä‘á»ƒ trÃºng thÆ°á»Ÿng!!",
                prize: "TrÃºng VÃ ng vÃ  Xe mÃ¡y!",
                alreadyVoted: "HÃ´m nay báº¡n Ä‘Ã£ bÃ¬nh chá»n rá»“i",
                selectedShop: "Cá»­a hÃ ng Ä‘Ã£ chá»n",
                lblName: "Há» vÃ  TÃªn (Ä‘á»ƒ nháº­n giáº£i)",
                namePlaceholder: "Nháº­p há» vÃ  tÃªn",
                lblPhone: "Sá»‘ Ä‘iá»‡n thoáº¡i",
                phonePlaceholder: "Nháº­p sá»‘ Ä‘iá»‡n thoáº¡i",
                rateLabel: "ÄÃ¡nh giÃ¡ cá»­a hÃ ng",
                pdpa: "ThÃ´ng tin cá»§a báº¡n sáº½ Ä‘Æ°á»£c thu tháº­p Ä‘á»ƒ liÃªn láº¡c. Chi tiáº¿t táº¡i ",
                pdpaLink: "ChÃ­nh sÃ¡ch báº£o máº­t",
                submit: "XÃ¡c nháº­n Ä‘Ã¡nh giÃ¡",
                loading: "Äang lÆ°u...",
                alertIncomplete: "ThÃ´ng tin chÆ°a Ä‘á»§",
                alertIncompleteMsg: "Vui lÃ²ng Ä‘iá»n Ä‘áº§y Ä‘á»§ thÃ´ng tin",
                alertPhoneError: "Sá»‘ Ä‘iá»‡n thoáº¡i khÃ´ng há»£p lá»‡",
                alertRateError: "Vui lÃ²ng chá»n 1-5 sao",
                alertPdpaError: "Vui lÃ²ng Ä‘á»“ng Ã½ chÃ­nh sÃ¡ch",
                alertSuccess: "ThÃ nh cÃ´ng!",
                alertSuccessMsg: "Cáº£m Æ¡n pháº£n há»“i cá»§a báº¡n",
                alertFail: "Lá»—i",
                alertFailMsg: "ÄÃ£ xáº£y ra lá»—i",
                btnOk: "OK"
            }
        };

        function changeLang(lang) {
            currentLang = lang;
            const t = translations[lang] || translations.th;
            
            document.getElementById('txt-header').innerText = t.header;
            document.getElementById('txt-subtitle').innerText = t.subtitle;
            document.getElementById('txt-prize').innerHTML = `<i class="fas fa-motorcycle"></i> ${t.prize}`;
            document.getElementById('alreadyVotedMsg').innerText = t.alreadyVoted;
            document.getElementById('txt-selected-shop').innerText = t.selectedShop;
            document.getElementById('lbl-name').innerHTML = `<i class="fas fa-user"></i> ${t.lblName}`;
            document.getElementById('nameInput').placeholder = t.namePlaceholder;
            document.getElementById('lbl-phone').innerHTML = `<i class="fas fa-phone"></i> ${t.lblPhone}`;
            document.getElementById('phoneInput').placeholder = t.phonePlaceholder;
            document.getElementById('txt-rate-label').innerText = t.rateLabel;
            
            const isAlreadyVoted = currentShopId && checkVoteHistory(currentShopId);
            document.getElementById('btnSubmit').innerText = isAlreadyVoted ? t.alreadyVoted : t.submit;
            
            document.getElementById('txt-loading').innerText = t.loading;
            document.getElementById('btn-modal-close').innerText = t.btnOk;
            
            const pdpaSpan = document.getElementById('txt-pdpa');
            pdpaSpan.innerHTML = `${t.pdpa} <a href="https://www.numberonemarket.com/privacy.php" target="_blank" id="txt-pdpa-link">${t.pdpaLink}</a>*`;
        }

        function checkVoteHistory(shopId) {
            const history = JSON.parse(localStorage.getItem('vote_history') || '{}');
            if (history[shopId]) {
                const lastVoteTime = new Date(history[shopId]).getTime();
                const currentTime = new Date().getTime();
                const diffHours = (currentTime - lastVoteTime) / (1000 * 60 * 60);
                if (diffHours < 24) return true;
            }
            return false;
        }

        async function main() {
            try {
                await liff.init({ liffId: LIFF_ID });
                if (!liff.isLoggedIn()) {
                    liff.login();
                } else {
                    const urlParams = new URLSearchParams(window.location.search);
                    currentShopId = urlParams.get('shop_id') || urlParams.get('shopId');

                    if (!currentShopId) {
                        const liffState = urlParams.get('liff.state');
                        if (liffState) {
                            const stateParams = new URLSearchParams(liffState.startsWith('?') ? liffState : '?' + liffState);
                            currentShopId = stateParams.get('shop_id') || stateParams.get('shopId');
                        }
                    }

                    if (currentShopId) {
                        try {
                            const response = await fetch(`${WEB_APP_URL}?getShopName=${currentShopId}`);
                            const rawData = await response.text();
                            
                            let textData = rawData.trim();
                            
                            if (textData.toLowerCase().includes('<!doctype html>') || textData.toLowerCase().includes('<html')) {
                                console.error("Permission Error HTML received:", textData.substring(0, 100));
                                currentShopName = "à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¸ªà¸´à¸—à¸˜à¸´à¹Œà¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡ (à¹‚à¸›à¸£à¸”à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸à¸²à¸£ Deploy)";
                            }
                            else if (textData.startsWith('[') || textData.startsWith('{')) {
                                try {
                                    const jsonData = JSON.parse(textData);
                                    let foundShop = null;
                                    
                                    if (Array.isArray(jsonData)) {
                                        foundShop = jsonData.find(s => {
                                            const sId = s.ShopID || s.shopId || s.id || s['Column A (ShopID)'];
                                            return sId && sId.toString().trim().toUpperCase() === currentShopId.trim().toUpperCase();
                                        });
                                    } else if (typeof jsonData === 'object') {
                                        foundShop = jsonData;
                                    }

                                    if (foundShop) {
                                        currentShopName = foundShop.ShopName || foundShop.shopName || foundShop['Column B (ShopName)'] || "à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸à¸Šà¸·à¹ˆà¸­à¸£à¹‰à¸²à¸™";
                                    } else {
                                        currentShopName = "à¹„à¸¡à¹ˆà¸à¸šà¸£à¹‰à¸²à¸™à¸„à¹‰à¸² (Shop Not Found)";
                                    }
                                } catch (e) {
                                    console.error("JSON Parse Error:", e);
                                    currentShopName = "à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸£à¸¹à¸›à¹à¸šà¸šà¸œà¸´à¸”à¸à¸¥à¸²à¸” (JSON Error)";
                                }
                            } else {
                                currentShopName = textData;
                            }
                            
                            document.getElementById('shopNameDisplay').innerText = currentShopName;

                            if (checkVoteHistory(currentShopId)) {
                                document.getElementById('alreadyVotedMsg').style.display = 'block';
                                document.getElementById('btnSubmit').disabled = true;
                                changeLang(currentLang);
                            }
                        } catch (err) {
                            console.error(err);
                            document.getElementById('shopNameDisplay').innerText = "Connection Error (à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸‚à¸±à¸”à¸‚à¹‰à¸­à¸‡)";
                        }
                    } else {
                        document.getElementById('shopNameDisplay').innerText = "à¹„à¸¡à¹ˆà¸à¸šà¸£à¸«à¸±à¸ªà¸£à¹‰à¸²à¸™à¸„à¹‰à¸²à¹ƒà¸™à¸£à¸°à¸šà¸š (No Shop ID)";
                    }
                }
                changeLang(currentLang);
            } catch (error) { console.error(error); }
        }

        function showAlert(title, msg, type) {
            const modal = document.getElementById('customAlert');
            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalMsg').innerText = msg;
            const icon = document.getElementById('modalIcon');
            icon.innerHTML = type === 'success' ? '<i class="fas fa-check-circle" style="color: #28a745;"></i>' : '<i class="fas fa-exclamation-circle" style="color: #ef4444;"></i>';
            modal.style.display = 'flex';
        }

        function closeAlert() { document.getElementById('customAlert').style.display = 'none'; }

        async function validateAndSubmit() {
            const t = translations[currentLang];
            if (currentShopId && checkVoteHistory(currentShopId)) return showAlert(t.alertFail, t.alreadyVoted, 'error');

            const name = document.getElementById('nameInput').value.trim();
            const phone = document.getElementById('phoneInput').value.trim();
            const ratingEl = document.querySelector('input[name="score_quality"]:checked');
            const pdpa = document.getElementById('pdpaConsent').checked;

            if (!name || !phone) return showAlert(t.alertIncomplete, t.alertIncompleteMsg, 'error');
            if (phone.length < 9) return showAlert(t.alertPhoneError, t.alertPhoneError, 'error');
            if (!ratingEl) return showAlert(t.alertRateError, t.alertRateError, 'error');
            if (!pdpa) return showAlert(t.alertPdpaError, t.alertPdpaError, 'error');

            submitVote(name, phone, ratingEl.value);
        }

        async function submitVote(name, phone, rating) {
            const t = translations[currentLang];
            document.getElementById('loading').style.display = 'flex';
            try {
                const profile = await liff.getProfile();
                const params = new URLSearchParams({
                    shopId: currentShopId,
                    shopName: currentShopName,
                    userId: profile.userId,
                    displayName: profile.displayName,
                    fullName: name,
                    phone: phone,
                    quality: rating
                });

                await fetch(WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: params
                });

                const history = JSON.parse(localStorage.getItem('vote_history') || '{}');
                history[currentShopId] = new Date().toISOString();
                localStorage.setItem('vote_history', JSON.stringify(history));

                document.getElementById('loading').style.display = 'none';
                showAlert(t.alertSuccess, t.alertSuccessMsg, 'success');
                setTimeout(() => { liff.closeWindow(); }, 2500);
            } catch (e) {
                document.getElementById('loading').style.display = 'none';
                showAlert(t.alertFail, t.alertFailMsg, 'error');
            }
        }

        main();
    </script>
</body>
</html>
