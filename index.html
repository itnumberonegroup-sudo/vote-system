<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>โหวตร้านค้า Numberone Market</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; text-align: center; }
        .rating { margin: 20px 0; border: 1px solid #ddd; padding: 10px; border-radius: 8px; }
        button { background: #00b900; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h2>โหวตร้านค้า: <span id="shopIdText">...</span></h2>
    <div id="voteForm">
        <div class="rating">ความสะอาด: <input type="number" id="clean" min="1" max="5" value="5"></div>
        <div class="rating">รสชาติอร่อย: <input type="number" id="taste" min="1" max="5" value="5"></div>
        <div class="rating">รอไม่นาน: <input type="number" id="wait" min="1" max="5" value="5"></div>
        <div class="rating">คุณภาพ: <input type="number" id="quality" min="1" max="5" value="5"></div>
        <button onclick="submitVote()">ส่งคะแนนโหวต</button>
    </div>

    <script>
        const LIFF_ID = 'ใส่_LIFF_ID_ของคุณที่ได้จากLINE_DEV'; 
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfcybyr.../exec'; // URL จากรูปที่ 5

        async function main() {
            await liff.init({ liffId: LIFF_ID });
            if (!liff.isLoggedIn()) { liff.login(); }
            const urlParams = new URLSearchParams(window.location.search);
            document.getElementById('shopIdText').innerText = urlParams.get('shop_id') || 'ไม่ได้ระบุร้าน';
        }

        async function submitVote() {
            const profile = await liff.getProfile();
            const urlParams = new URLSearchParams(window.location.search);
            const shopId = urlParams.get('shop_id');
            const params = new URLSearchParams({
                shopId: shopId,
                userId: profile.userId,
                displayName: profile.displayName,
                clean: document.getElementById('clean').value,
                taste: document.getElementById('taste').value,
                wait: document.getElementById('wait').value,
                quality: document.getElementById('quality').value
            });

            const res = await fetch(`${WEB_APP_URL}?${params.toString()}`);
            const text = await res.text();
            if (text === "DUPLICATE") alert("คุณเคยโหวตร้านนี้ไปแล้ว!");
            else { alert("โหวตสำเร็จ!"); liff.closeWindow(); }
        }
        main();
    </script>
</body>
</html>