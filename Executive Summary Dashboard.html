<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Best of Number One Market - Modern Dashboard</title>

    <link rel="apple-touch-icon" href="my-logo.png">
    <link rel="icon" type="image/png" sizes="192x192" href="my-logo.png">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=IBM+Plex+Sans+Thai:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --font-main: 'IBM Plex Sans Thai', 'Inter', sans-serif;
            --font-display: 'Inter', 'IBM Plex Sans Thai', sans-serif;
        }
        body { 
            font-family: var(--font-main);
            background: #f8fafc;
            color: #1e293b;
        }
        h1, h2, h3, .stat-value { font-family: var(--font-display); }
        .glass { 
            backdrop-filter: blur(20px) saturate(180%);
            background-color: rgba(255, 255, 255, 0.8);
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
        }
        .text-gradient {
            background: linear-gradient(135deg, #2563eb 0%, #0ea5e9 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .card-hover { transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .card-hover:hover { transform: translateY(-8px); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.08); }
    </style>
</head>
<body class="min-h-screen pb-12">

    <!-- Loading Screen -->
    <div id="loading-screen" class="fixed inset-0 z-[100] flex items-center justify-center bg-white transition-opacity duration-700">
        <div class="flex flex-col items-center gap-6">
            <div class="relative w-16 h-16">
                <div class="absolute inset-0 border-4 border-slate-100 rounded-full"></div>
                <div class="absolute inset-0 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
            </div>
            <p class="font-medium text-slate-500 animate-pulse text-sm">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡πà‡∏≤‡∏ô Proxy API...</p>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-slate-900/60 backdrop-blur-md p-4 overflow-y-auto">
        <div class="my-auto w-full max-w-xl rounded-[2.5rem] bg-white p-8 shadow-2xl scale-95 transition-all border border-slate-100">
            <div class="mb-8 flex items-center justify-between border-b border-slate-50 pb-5">
                <h2 class="text-2xl font-bold flex items-center gap-3">
                    <span class="p-2.5 bg-blue-600 rounded-2xl text-white shadow-lg shadow-blue-200">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                    </span>
                    ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö
                </h2>
                <button onclick="toggleSettings(false)" class="rounded-2xl bg-slate-50 p-2 text-slate-400 hover:bg-slate-100 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            
            <div class="space-y-8">
                <div class="space-y-3">
                    <label class="text-xs font-bold text-slate-500 uppercase tracking-widest ml-1 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                        ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ LOGO ‡∏ï‡∏•‡∏≤‡∏î (‡∏ó‡∏£‡∏á‡∏¢‡∏≤‡∏ß)
                    </label>
                    <div class="flex gap-3">
                        <input id="input-logo" type="text" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà" class="flex-1 rounded-2xl border border-slate-200 bg-slate-50 p-4 text-sm font-medium focus:border-blue-500 focus:bg-white focus:ring-4 focus:ring-blue-500/10 outline-none transition-all">
                    </div>
                </div>

                <div class="space-y-4">
                    <label class="text-xs font-bold text-slate-500 uppercase tracking-widest ml-1 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
                        ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏ã‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤
                    </label>
                    <div id="zone-configs-container" class="grid gap-4"></div>
                </div>
            </div>

            <button onclick="saveSettings()" class="mt-10 w-full flex items-center justify-center gap-3 rounded-[1.8rem] bg-slate-900 py-5 font-bold text-white shadow-xl shadow-slate-200 hover:bg-blue-600 active:scale-[0.98] transition-all">
                ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
            </button>
        </div>
    </div>

    <!-- Header Section -->
    <header class="sticky top-0 z-40 glass px-4 py-6 md:px-10">
        <div class="max-w-7xl mx-auto flex flex-col gap-6 lg:flex-row lg:items-center lg:justify-between">
            <div class="flex flex-col items-center text-center lg:items-start lg:text-left">
                <div id="logo-display-container" class="mb-4 transition-all duration-500 min-h-[80px] flex items-center"></div>
                <h1 class="text-2xl font-extrabold text-slate-900 tracking-tight sm:text-4xl uppercase">
                    THE BEST OF <span class="text-gradient">NUMBER ONE MARKET</span>
                </h1>
                <div class="mt-3 flex items-center gap-2 text-[10px] font-bold text-slate-400 uppercase tracking-[0.25em]">
                    <span class="flex h-2.5 w-2.5 rounded-full bg-emerald-500 animate-pulse shadow-[0_0_8px_rgba(16,185,129,0.5)]"></span>
                    ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (üîí ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ñ‡∏π‡∏Å‡∏Å‡∏£‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô Proxy): <span id="last-update" class="text-slate-600">--:--:--</span>
                </div>
            </div>

            <div class="flex items-center justify-center gap-3">
                <button onclick="toggleSettings(true)" class="group flex items-center gap-2 rounded-2xl bg-white px-6 py-4 text-xs font-bold text-slate-700 shadow-sm border border-slate-200 hover:border-blue-400 hover:text-blue-600 transition-all">
                    ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                </button>
                <button onclick="fetchData()" class="flex items-center gap-2 rounded-2xl bg-blue-600 px-8 py-4 text-xs font-bold text-white shadow-xl shadow-blue-500/30 hover:bg-blue-700 transition-all uppercase">
                    ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 md:px-10 mt-10 space-y-12">
        <div id="stats-grid" class="grid grid-cols-2 gap-5 lg:grid-cols-4"></div>
        <section class="space-y-6">
            <h2 class="text-2xl font-bold text-slate-800 flex items-center gap-3">
                <span class="w-2 h-8 bg-blue-500 rounded-full"></span>
                ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏≤‡∏¢‡πÇ‡∏ã‡∏ô
            </h2>
            <div id="zone-summary-grid" class="grid grid-cols-1 gap-6 lg:grid-cols-3"></div>
        </section>
        <section id="top-5-grid" class="grid grid-cols-1 gap-8 md:grid-cols-3"></section>
        <section class="relative rounded-[3rem] bg-slate-900 p-8 sm:p-14 shadow-3xl text-white overflow-hidden">
            <div id="top-10-list" class="grid grid-cols-1 gap-5 md:grid-cols-2 relative z-10"></div>
        </section>
    </main>

    <script>
        // *** ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Web App URL ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ***
        const PROXY_API_URL = "https://script.google.com/macros/s/AKfycbzYqf3clGc9goZOhScx44uWU1XCX96y0GhvyRrw7gGmvYk3kujHyfLRg8GrRtWSsZ2V5w/exec";

        let appSettings = {
            logoUrl: "https://lh3.googleusercontent.com/d/1tUpAvRAPs2WPkrYzpXs77VQ13fRB172y",
            zones: {
                zone1: { name: "‡πÇ‡∏ã‡∏ô 1 ‡∏ï‡∏•‡∏≤‡∏î‡∏ô‡∏±‡∏°‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ß‡∏±‡∏ô", start: 1, end: 50, color: 'blue' },
                zone2: { name: "‡πÇ‡∏ã‡∏ô 2 One Food Street", start: 51, end: 100, color: 'purple' },
                zone3: { name: "‡πÇ‡∏ã‡∏ô 3 ‡πÇ‡∏ï‡πâ‡∏£‡∏∏‡πà‡∏á", start: 101, end: 300, color: 'orange' }
            }
        };

        let rawData = [];

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå Google Drive ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Direct Link
        function convertDriveUrl(url) {
            if (!url) return "";
            if (url.startsWith('https://lh3.googleusercontent.com/d/')) return url;
            let id = "";
            if (url.includes('drive.google.com/file/d/')) {
                const parts = url.split('/d/');
                if (parts.length > 1) id = parts[1].split('/')[0].split('?')[0];
            } else if (url.includes('id=')) {
                id = url.split('id=')[1].split('&')[0];
            }
            return id ? `https://lh3.googleusercontent.com/d/${id}` : url;
        }

        async function fetchData() {
            try {
                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡πà‡∏≤‡∏ô Proxy API ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
                const response = await fetch(PROXY_API_URL + "?_=" + new Date().getTime());
                if (!response.ok) throw new Error("API Connection failed");
                
                rawData = await response.json();
                processData();
                hideLoading();
            } catch (err) {
                console.error("Fetch Error:", err);
                hideLoading();
            }
        }

        function processData() {
            const stats = { totalVotes: rawData.length, totalScore: 0 };
            const shops = new Set();
            const shopPerformance = {};
            const zoneStats = {};
            
            Object.values(appSettings.zones).forEach(z => zoneStats[z.name] = { votes: 0, shops: new Set(), score: 0 });
            zoneStats["‡∏≠‡∏∑‡πà‡∏ô‡πÜ"] = { votes: 0, shops: new Set(), score: 0 };

            rawData.forEach(d => {
                const shopId = d.ShopID || "";
                const shopName = d.ShopName || "‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠";
                const scoreQuality = parseFloat(d.Score_Quality) || 0;
                if (!shopId) return;

                shops.add(shopId);
                stats.totalScore += scoreQuality;

                const n = parseInt(shopId.replace(/\D/g, '')) || 0;
                let zoneName = "‡∏≠‡∏∑‡πà‡∏ô‡πÜ";
                for (const key in appSettings.zones) {
                    const z = appSettings.zones[key];
                    if (n >= z.start && n <= z.end) { zoneName = z.name; break; }
                }

                if (!zoneStats[zoneName]) zoneStats[zoneName] = { votes: 0, shops: new Set(), score: 0 };
                zoneStats[zoneName].votes++;
                zoneStats[zoneName].shops.add(shopId);
                zoneStats[zoneName].score += scoreQuality;

                if (!shopPerformance[shopId]) {
                    shopPerformance[shopId] = { name: shopName, zone: zoneName, votes: 0, score: 0 };
                }
                shopPerformance[shopId].votes++;
                shopPerformance[shopId].score += scoreQuality;
            });

            const shopList = Object.values(shopPerformance).map(s => ({
                ...s,
                percent: s.votes > 0 ? ((s.score / (s.votes * 5)) * 100).toFixed(1) : 0
            }));

            renderUI(stats, shops.size, zoneStats, shopList);
        }

        function renderUI(stats, uniqueShopsCount, zoneStats, shopList) {
            document.getElementById('last-update').innerText = new Date().toLocaleTimeString('th-TH');
            const avgSatisfy = stats.totalVotes > 0 ? ((stats.totalScore / (stats.totalVotes * 5)) * 100).toFixed(1) : 0;
            
            document.getElementById('stats-grid').innerHTML = `
                ${renderStatCard("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÇ‡∏´‡∏ß‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", stats.totalVotes, "VOTES", "blue")}
                ${renderStatCard("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤", uniqueShopsCount, "SHOPS", "purple")}
                ${renderStatCard("‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°", stats.totalScore, "POINTS", "orange")}
                ${renderStatCard("‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢", avgSatisfy, "%", "emerald")}
            `;

            const zoneGrid = document.getElementById('zone-summary-grid');
            zoneGrid.innerHTML = '';
            Object.keys(appSettings.zones).forEach(key => {
                const z = appSettings.zones[key];
                const data = zoneStats[z.name] || { votes: 0, score: 0 };
                const percent = data.votes > 0 ? ((data.score / (data.votes * 5)) * 100).toFixed(1) : 0;
                zoneGrid.innerHTML += `
                    <div class="rounded-[2rem] bg-white p-7 shadow-sm border-l-8 border-blue-500 card-hover">
                        <div class="mb-5 flex justify-between items-start">
                            <h3 class="text-sm font-extrabold text-slate-800 uppercase">${z.name}</h3>
                            <span class="text-2xl font-black text-slate-900">${percent}%</span>
                        </div>
                        <div class="h-2 w-full rounded-full bg-slate-100 overflow-hidden">
                            <div class="h-full bg-blue-600" style="width: ${percent}%"></div>
                        </div>
                    </div>
                `;
            });

            const top10 = shopList.sort((a,b) => b.percent - a.percent).slice(0, 10);
            document.getElementById('top-10-list').innerHTML = top10.map((s, i) => `
                <div class="flex items-center gap-5 rounded-[1.8rem] bg-white/5 p-5 border border-white/5 transition-all hover:bg-white/10">
                    <div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl font-black ${i < 3 ? 'bg-blue-600 text-white' : 'bg-white/10 text-slate-400'}">${i+1}</div>
                    <div class="flex-1 min-w-0"><h3 class="truncate font-bold text-white">${s.name}</h3></div>
                    <div class="text-right"><div class="text-2xl font-black text-blue-400">${s.percent}%</div></div>
                </div>
            `).join('');

            // Render Top 5 per Zone
            const top5Grid = document.getElementById('top-5-grid');
            top5Grid.innerHTML = '';
            Object.values(appSettings.zones).forEach(z => {
                const filtered = shopList.filter(s => s.zone === z.name).sort((a,b) => b.percent - a.percent).slice(0, 5);
                top5Grid.innerHTML += `
                    <div class="rounded-[2.5rem] bg-white p-8 shadow-sm border border-slate-100 card-hover">
                        <h3 class="mb-7 text-[11px] font-extrabold text-slate-800 border-b border-slate-100 pb-4 uppercase tracking-widest">${z.name}</h3>
                        <div class="space-y-4">
                            ${filtered.length > 0 ? filtered.map((s, i) => `<div class="flex justify-between text-xs font-bold"><span>${i+1}. ${s.name}</span><span class="text-blue-600">${s.percent}%</span></div>`).join('') : '<p class="text-[10px] text-slate-300 italic">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>'}
                        </div>
                    </div>
                `;
            });
        }

        function renderStatCard(title, value, unit, color) {
            const colors = { blue: 'from-blue-600 to-blue-500', purple: 'from-purple-600 to-purple-500', orange: 'from-orange-500 to-orange-400', emerald: 'from-emerald-600 to-emerald-500' };
            return `<div class="rounded-[2.5rem] bg-gradient-to-br ${colors[color]} p-6 text-white shadow-lg"><p class="text-[10px] font-extrabold uppercase opacity-70 mb-4">${title}</p><div class="flex items-baseline gap-2"><span class="text-3xl font-black">${value}</span><span class="text-[11px] font-bold opacity-50 uppercase">${unit}</span></div></div>`;
        }

        function updateLogoDisplay() {
            const container = document.getElementById('logo-display-container');
            const url = convertDriveUrl(appSettings.logoUrl);
            if (url) {
                container.innerHTML = `<img src="${url}" alt="Market Logo" class="h-24 w-auto object-contain drop-shadow-md rounded-xl">`;
            } else {
                container.innerHTML = `<div class="flex h-20 w-64 items-center justify-center rounded-2xl border-2 border-dashed border-slate-200 bg-slate-50 text-slate-400 cursor-pointer font-bold text-[10px] uppercase" onclick="toggleSettings(true)">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ LOGO</div>`;
            }
        }

        function renderZoneInputs() {
            const container = document.getElementById('zone-configs-container');
            container.innerHTML = '';
            Object.keys(appSettings.zones).forEach(key => {
                const z = appSettings.zones[key];
                container.innerHTML += `
                    <div class="rounded-2xl border border-slate-100 bg-slate-50 p-5">
                        <div class="mb-3"><label class="block text-[9px] font-bold text-slate-400 uppercase mb-1">‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏ã‡∏ô</label><input id="${key}-name" type="text" value="${z.name}" class="w-full rounded-xl border border-slate-200 p-2 text-sm font-bold"></div>
                        <div class="flex gap-4">
                            <div class="flex-1"><label class="block text-[9px] font-bold text-slate-400 uppercase mb-1">ID ‡πÄ‡∏£‡∏¥‡πà‡∏°</label><input id="${key}-start" type="number" value="${z.start}" class="w-full rounded-xl border border-slate-200 p-2 text-center font-bold"></div>
                            <div class="flex-1"><label class="block text-[9px] font-bold text-slate-400 uppercase mb-1">ID ‡∏à‡∏ö</label><input id="${key}-end" type="number" value="${z.end}" class="w-full rounded-xl border border-slate-200 p-2 text-center font-bold"></div>
                        </div>
                    </div>`;
            });
        }

        function hideLoading() { document.getElementById('loading-screen').classList.add('opacity-0'); setTimeout(() => document.getElementById('loading-screen').style.display = 'none', 700); }
        function toggleSettings(show) { if(show) renderZoneInputs(); document.getElementById('settings-modal').classList.toggle('hidden', !show); }
        function loadSettings() { const saved = localStorage.getItem('market_settings_v5'); if (saved) appSettings = {...appSettings, ...JSON.parse(saved)}; }
        function saveSettings() { 
            const logoIn = document.getElementById('input-logo').value.trim();
            if(logoIn) appSettings.logoUrl = logoIn;
            Object.keys(appSettings.zones).forEach(key => {
                appSettings.zones[key].name = document.getElementById(`${key}-name`).value;
                appSettings.zones[key].start = parseInt(document.getElementById(`${key}-start`).value);
                appSettings.zones[key].end = parseInt(document.getElementById(`${key}-end`).value);
            });
            localStorage.setItem('market_settings_v5', JSON.stringify(appSettings)); 
            toggleSettings(false); 
            updateLogoDisplay();
            fetchData(); 
        }

        window.onload = () => { loadSettings(); updateLogoDisplay(); fetchData(); setInterval(fetchData, 30000); };
    </script>
</body>
</html>
